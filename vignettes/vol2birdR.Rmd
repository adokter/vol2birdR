---
title: "Introduction to vol2birdR"
author: Adriaan M. Dokter & Anders Henja
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Introduction to vol2birdR}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---


vol2birdR is an R package for providing support to calculate vertical profiles and other biological scatteres from weather radar data. The original
**vol2bird** is written as a C-package and has been migrated to also work as an R package.

# Introduction
The vol2birdR package provides necessary functions to process radar data. This package can also use libtorch to utilize machine learning during the processing of radar data. This documentation only
gives a brief introduction on how to use vol2birdR. For more information just type:
`library(help=vol2birdR)` 

# Usage
## Mistnet
Mistnet is a deep convolution neural net for segmentating out rain in S-band radar data, see the publication at https://besjournals.onlinelibrary.wiley.com/doi/full/10.1111/2041-210X.13280. 
To use this functionality you will have to install the mistnet software as part of running the vol2birdR library. This is easilly done by calling install_mistnet after the library has been loaded.
```R
library(vol2birdR)
install_mistnet()
```
This will download libtorch from the download section of https://pytorch.org as well as a wrapper library from our AWS that enables the mistnet functionality. The mistnet model has to be manually downloaded and
specified in the configuration instance. The default location of the mistnet model is /opt/vol2bird/etc/mistnet_nexrad.pt.
You can download the mistnet model from http://mistnet.s3.amazonaws.com/mistnet_nexrad.pt.
`wget http://mistnet.s3.amazonaws.com/mistnet_nexrad.pt -O "/home/docuser/etc/mistnet_nexrad.pt"`
 

## Processing
Processing of the radar data will always be performed in a similar way. First you create the configuration instance and modify configuration according to needs. 
Then the actual processor is initiated and then the processing is performed.

```R
library(vol2birdR)
config<-Vol2BirdConfig$new()
config$verbose<-TRUE
config$useMistNet<-TRUE
processor<-Vol2Bird$new()
processor$process(c("/...../volume.h5"),config,"vp.h5","pvol.h5")
```

Let's break down the above example.

First the vol2birdR library is loaded by using
`library(vol2birdR)`

The next step is where we setup the configuration required. This can be modified heavily and the best way to learn about this is to read the documentation about the config-class.
In this example, the configuration is set to printout verbose output and that the torch library (mistnet) should be used using the mistnet model downloaded earlier. 
```R
config<-Vol2BirdConfig$new()
config$verbose<-TRUE
config$useMistNet<-TRUE
config$mistNetPath<-"/home/docuser/etc/mistnet_nexrad.pt"
```

In the final step the processing is performed where the input is a ODIM H5 volume, above defined configuration and output is a vertical profile and a polar volume.

## Vol2BirdConfig
As mentioned earlier, all processing involves a config instance where all options are set. These options involves everything from printing certain information
to what type of processing that should be performed.
In some cases it might be necessary to copy configuration instances for whatever reason. In these cases you can't just assign the instances like
```R
config<-Vol2BirdConfig$new()
extraconfig<-config
```
When doing like this, the config and extraconfig instances will both refer to the same object. To avoid this, use either clone or the copy constructor like
```R
config<-Vol2BirdConfig$new()
extraconfig<-config$clone()             # Clone method
otherconfig<-Vol2BirdConfig$new(config) # Copy constructor
```

Copyright 2010-2021 Adriaan M. Dokter (Cornell lab of Ornithology, University of Amsterdam) & Netherlands eScience Centre
